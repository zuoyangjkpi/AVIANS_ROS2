# NMPC Tracker Parameters Configuration
# ROS2 Jazzy compatible parameter file

nmpc_tracker_node:
  ros__parameters:
    # Control parameters
    control_frequency: 10.0          # Hz - NMPC control loop frequency
    person_timeout: 2.0              # seconds - timeout for person detection
    enable_visualization: true       # Enable RViz visualization
    
    # Frame IDs
    drone_frame: "X3/base_link"      # Drone base frame
    world_frame: "world"             # World/map frame
    camera_frame: "camera_link"      # Camera frame
    
    # NMPC algorithm parameters
    nmpc:
      timestep: 0.25                 # seconds - NMPC time step
      lookahead: 2.0                 # seconds - prediction horizon
      max_iterations: 50             # Maximum optimization iterations
      convergence_tolerance: 1.0e-4  # Convergence tolerance
      step_size: 0.01                # Gradient descent step size
      regularization: 1.0e-6         # Regularization parameter
    
    # Drone physical parameters
    drone:
      mass: 1.5                      # kg - drone mass
      max_velocity: 3.0              # m/s - maximum velocity
      max_acceleration: 2.0          # m/s^2 - maximum acceleration
      max_angular_velocity: 1.0      # rad/s - maximum angular velocity
      gravity: 9.81                  # m/s^2 - gravitational acceleration
    
    # Person tracking parameters
    tracking:
      optimal_distance: 4.0          # m - optimal tracking distance
      min_distance: 2.0              # m - minimum safe distance
      max_distance: 8.0              # m - maximum tracking distance
      height_offset: 1.5             # m - height above person for tracking
      
      # Camera parameters
      camera_fov_horizontal: 1.047   # rad - 60 degrees horizontal FOV
      camera_fov_vertical: 0.785     # rad - 45 degrees vertical FOV
      camera_tilt_angle: -0.524      # rad - -30 degrees camera tilt
    
    # Cost function weights
    weights:
      # State tracking weights
      position: [10.0, 10.0, 8.0]           # [x, y, z] position weights
      velocity: [2.0, 2.0, 2.0]             # [vx, vy, vz] velocity weights
      attitude: [1.0, 1.0, 3.0]             # [roll, pitch, yaw] attitude weights
      angular_rate: [0.5, 0.5, 1.0]         # [wx, wy, wz] angular rate weights
      
      # Control effort weights
      control: [0.1, 0.5, 0.5, 0.3]         # [thrust, roll, pitch, yaw_rate] control weights
      
      # Person tracking specific weights
      tracking_distance: 5.0                 # Weight for maintaining optimal distance
      camera_angle: 3.0                      # Weight for keeping person in view
      smooth_tracking: 2.0                   # Weight for smooth motion
    
    # State constraints
    constraints:
      # Position limits [min, max] in meters
      position_x: [-50.0, 50.0]
      position_y: [-50.0, 50.0]
      position_z: [0.5, 20.0]
      
      # Velocity limits [min, max] in m/s
      velocity_x: [-3.0, 3.0]
      velocity_y: [-3.0, 3.0]
      velocity_z: [-3.0, 3.0]
      
      # Attitude limits [min, max] in radians
      roll: [-0.785, 0.785]          # ±45 degrees
      pitch: [-0.785, 0.785]         # ±45 degrees
      yaw: [-3.14159, 3.14159]       # ±180 degrees
      
      # Angular rate limits [min, max] in rad/s
      angular_rate: [-1.0, 1.0]
    
    # Control constraints
    control_limits:
      # Thrust limits [min, max] in Newtons
      thrust: [0.0, 20.0]
      
      # Attitude command limits [min, max] in radians
      roll_cmd: [-0.524, 0.524]      # ±30 degrees
      pitch_cmd: [-0.524, 0.524]     # ±30 degrees
      yaw_rate_cmd: [-1.0, 1.0]      # ±1 rad/s
    
    # Environmental parameters
    environment:
      air_density: 1.225             # kg/m^3
      wind_velocity: [0.0, 0.0, 0.0] # [wx, wy, wz] m/s
      wind_turbulence: 0.1           # Wind turbulence factor
    
    # Logging and debugging
    debug:
      log_level: "INFO"              # DEBUG, INFO, WARN, ERROR
      save_trajectory_data: false    # Save trajectory data to file
      publish_debug_info: true       # Publish additional debug information
    
    # Topic names (can override defaults)
    topics:
      drone_state: "/X3/odometry"
      person_detections: "/person_detections"
      control_output: "/X3/cmd_vel"
      trajectory_vis: "/nmpc/trajectory"
      target_vis: "/nmpc/target"
      status: "/nmpc/status"
      enable: "/nmpc/enable"

